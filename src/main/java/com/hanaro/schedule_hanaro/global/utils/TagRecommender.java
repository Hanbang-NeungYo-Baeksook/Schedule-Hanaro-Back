package com.hanaro.schedule_hanaro.global.utils;

import java.util.*;
import java.util.stream.Collectors;

public class TagRecommender {
    // 사전 정의된 태그 목록
    private static final List<String> PREDEFINED_TAGS = Arrays.asList(
            "인증", "확인", "인증서", "계좌", "통장", "변경", "뱅킹", "금융", "대출", "한도",
            "신청", "등록", "조회", "결과", "예금", "적금", "고객", "개인", "회원", "비밀번호",
            "보안", "소득", "증명서", "증빙", "서류", "자료", "거래", "입금", "금리", "계약",
            "약정", "투자", "자금", "문의", "상담", "우대", "포인트", "지점", "전화", "모바일",
            "기간", "조건", "업무", "조치", "제출", "화면", "입력", "상태", "서비스", "비대면", "미성년자"
    );

    // 태그별 관련 키워드 매핑
    private static final Map<String, List<String>> TAG_KEYWORDS = new HashMap<>() {{
        put("인증", Arrays.asList(
            "인증", "본인", "확인", "인증서", "발급", "등록", "공동인증서", "금융인증서", "생체인증",
            "지문", "안면", "간편인증", "PIN", "패스워드", "비밀번호", "인증번호", "SMS인증",
            "카카오인증", "네이버인증", "토큰", "QR인증", "보안카드", "신분증", "신분확인"
        ));

        put("계좌", Arrays.asList(
            "계좌", "통장", "잔액", "이체", "송금", "입금", "출금", "계좌번호", "예금주",
            "자동이체", "이체한도", "수수료", "계좌개설", "통장전환", "거래내역", "잔고",
            "계좌정보", "통장정리", "통장발급", "계좌연동", "연결계좌", "주거래계좌",
            "급여계좌", "마이너스통장", "종합통장", "외화계좌", "CMA", "MMF"
        ));

        put("대출", Arrays.asList(
            "대출", "한도", "금리", "상환", "이자", "대부", "담보", "신용", "원금", "만기",
            "중도상환", "대출한도", "신용등급", "이자율", "대출심사", "대출상품", "신용대출",
            "담보대출", "주택대출", "전세대출", "마이너스대출", "카드대출", "대출",
            "분할상환", "원리금", "연체", "상환스케줄", "대출기간", "대출조건", "신용점수"
        ));

        put("신청", Arrays.asList(
            "신청", "접수", "발급", "개설", "가입", "등록", "신규", "발행", "해지", "변경",
            "취소", "신청서", "접수증", "신청방법", "신청절차", "신청상태", "재신청",
            "신청기간", "신청조건", "신청자격", "신청양식", "신청확인", "승인", "반려",
            "보완요청", "신청취소", "온라인신청", "모바일신청", "비대면신청"
        ));

        put("조회", Arrays.asList(
            "조회", "확인", "내역", "거래내역", "잔액", "한도", "결과", "상태", "현황",
            "내용", "기록", "조회기간", "상세조회", "실시간조회", "잔액조회", "한도조회",
            "대출조회", "이체내역", "거래결과", "승인내역", "미승인내역", "보유내역",
            "이용내역", "납부내역", "청구내역", "포인트조회", "혜택조회"
        ));

        put("보안", Arrays.asList(
            "보안", "비밀번호", "암호", "보안", "보호", "해킹", "피싱", "보안카드", "OTP",
            "2채널", "이상거래", "보안등급", "보안설정", "보안문자", "보안프로그램",
            "백신", "공인인증서", "보안카드", "2차인증", "생체인증", "지문인증",
            "안면인증", "패턴", "PIN번호", "보안질문", "디바이스인증", "추가인증"
        ));

        put("서류", Arrays.asList(
            "서류", "증명서", "증빙", "자료", "신분증", "등본", "초본", "재직증명서",
            "소득증빙", "계약서", "신청서", "주민등록증", "운전면허증", "여권",
            "사업자등록증", "재무제표", "원천징수영수증", "급여명세서", "근로계약서",
            "임대차계약서", "등기부등본", "납세증명서", "건강보험자격득실확인서",
            "기타증빙서류", "전자서명", "전자문서"
        ));

        put("금융", Arrays.asList(
            "금융", "은행", "예금", "적금", "펀드", "투자", "주식", "채권", "환전", "외환",
            "금리", "수수료", "금융상품", "금융서비스", "금융거래", "금융기관", "증권",
            "보���", "카드", "외화", "원화", "금융자산", "금융시장", "금융정책", "금융혜택",
            "금융수수료", "금융규제", "금융정보", "금융교육", "금융상담"
        ));

        put("고객", Arrays.asList(
            "고객", "회원", "가입자", "개인", "법인", "사업자", "미성년자", "외국인",
            "상속인", "대리인", "고객센터", "고객문의", "고객상담", "고객지원", "회원가입",
            "회원정보", "개인정보", "법인정보", "사업자정보", "신규고객", "기존고객",
            "우수고객", "VIP고객", "등급", "혜택", "특전", "우대", "멤버십"
        ));

        put("비대면", Arrays.asList(
            "비대면", "온라인", "모바일", "앱", "인터넷", "웹", "전자", "디지털", "스마트",
            "원격", "비대면계좌", "비대면서비스", "비대면신청", "화상상담", "전자서명",
            "모바일뱅킹", "인터넷뱅킹", "스마트뱅킹", "디지털채널", "온라인신청",
            "모바일앱", "웹사이트", "화상", "원격상담", "비접촉", "언택트", "디지털금융"
        ));

        put("상담", Arrays.asList(
            "상담", "문의", "안내", "설명", "답변", "응대", "질문", "요청", "불만", "민원",
            "고충", "상담센터", "고객센터", "콜센터", "상담원", "전화상담", "채팅상담",
            "화상상담", "대면상담", "비대면상담", "상담예약", "상담시간", "상담내용",
            "상담결과", "상담이력", "문의사항", "불편사항", "건의사항", "피드백"
        ));

        put("변경", Arrays.asList(
            "변경", "수정", "갱신", "재발급", "해지", "취소", "정정", "변동", "업데이트",
            "정보변경", "주소변경", "연락처변경", "비밀번호변경", "한도변경", "계좌변경",
            "카드변경", "상품변경", "조건변경", "기간변경", "해지신청", "변경신청",
            "변경이력", "변경사유", "변경절차", "변경방법", "변경확인"
        ));

        put("뱅킹", Arrays.asList(
            "뱅킹", "인터넷뱅킹", "모바일뱅킹", "스마트뱅킹", "폰뱅킹", "전자금융",
            "온라인뱅킹", "디지털뱅킹", "뱅킹앱", "뱅킹서비스", "오픈뱅킹", "간편뱅킹",
            "스마트폰뱅킹", "태블릿뱅킹", "웹뱅킹", "전화뱅킹", "자동화기기", "ATM",
            "CD기", "계좌이체", "이체한도", "보안설정", "로그인", "공인인증서"
        ));

        put("거래", Arrays.asList(
            "거래", "이체", "결제", "송금", "입금", "출금", "환전", "납부", "청구", "정산",
            "매매", "거래내역", "거래한도", "거래제한", "거래정지", "거래확인", "거래시간",
            "거래금액", "거래수수료", "거래은행", "거래점", "거래처", "거래유형", "거래방식",
            "거래승인", "거래취소", "거래완료", "거래실패", "거래조회", "거래기록"
        ));

        put("우대", Arrays.asList(
            "우대", "혜택", "할인", "캐시백", "포인트", "마일리지", "리워드", "이벤트",
            "프로모션", "특전", "우대금리", "우대수수료", "우대조건", "우대기간", "우대한도",
            "멤버십", "등급", "VIP", "프리미엄", "스페셜", "우수고객", "충성고객",
            "우대서비스", "추가혜택", "보너스", "특별우대", "우대정책", "우대프로그램"
        ));

        put("지점", Arrays.asList(
            "지점", "영업점", "점포", "창구", "ATM", "CD기", "은행", "센터", "지사", "출장소",
            "영업소", "본점", "지역본부", "영업시간", "방문", "내방", "창구업무", "대기시간",
            "번호표", "위치", "주소", "전화번호", "담당자", "상담창구", "예약방문",
            "무인점포", "스마트점포", "디지털점포", "365코너", "외환센터"
        ));

        put("서비스", Arrays.asList(
            "서비스", "기능", "업무", "절차", "진행", "방법", "과정", "단계", "시간", "담당",
            "업무시간", "업무처리", "업무절차", "업무방법", "업무지침", "업무안내",
            "업무담당자", "업무진행", "업무완료", "업무확인", "업무요청", "업무지연",
            "업무오류", "업무실수", "업무문의", "업무협조", "업무제한", "업무시스템"
        ));

        put("예금", Arrays.asList(
            "예금", "적금", "정기예금", "보통예금", "저축", "입출금", "이자", "만기", "해지",
            "연장", "예치", "예치금", "예금주", "예금종류", "예금상품", "예금계", "예금거래",
            "예금잔액", "예금이율", "특판예금", "자유적금", "정기적금", "급여예금",
            "종합예금", "외화예금", "양도성예금", "청년예금", "주택청약", "재형저축"
        ));

        put("투자", Arrays.asList(
            "투자", "펀드", "주식", "채권", "ELS", "CMA", "ISA", "연금", "수익률", "위험도",
            "투자상품", "투자원금", "투자기간", "투자한도", "투자위험", "투자설명서",
            "투자성향", "투자전략", "투자실적", "투자손실", "분산투자", "재투자", "환매",
            "매수", "매도", "투자자문", "투자일임", "투자신탁", "투자증권", "투자계획"
        ));

        put("약정", Arrays.asList(
            "약정", "계약", "동의", "약관", "규정", "조건", "기간", "한도", "제한", "의무",
            "약정서", "계약서", "약정기간", "약정금액", "약정이율", "약정조건", "약정내용",
            "약정일자", "약정해지", "약정만료", "재약정", "연장약정", "특약", "부대약정",
            "약정사항", "약정위반", "약정준수", "약정체결", "약정신"
        ));

        put("미성년자", Arrays.asList(
            "미성년자", "청소년", "어린이", "주니어", "영유아", "학생", "아동", "법정대리인",
            "친권자", "후견인", "보호자", "법정대리인동의", "미성년자계좌", "학생증",
            "주니어통장", "어린이통장", "청소년카드", "영유아보험", "교육적금",
            "미성년자신탁", "미성년자대출", "청소년수당", "아동수당", "학자금",
            "미성년자보호", "연령제한", "가족계좌", "주니어적금"
        ));

        put("자금", Arrays.asList(
            "자금", "현금", "자본", "여유자금", "운영자금", "대출자금", "투자자금",
            "결제자금", "정산자금", "보증금", "예치금", "적립금", "자금이체", "자금조달",
            "자금운용", "자금세탁", "자금흐름", "자금계획", "자금지원", "자금관리",
            "자금부족", "자금여유", "자금회수", "자금조회", "자금거래", "자금차입",
            "자금상환", "자금용도", "자금출처"
        ));

        put("업무", Arrays.asList(
            "업무", "처리", "절차", "진행", "방법", "과정", "단계", "시간", "담당", "접수",
            "업무시간", "업무처리", "업무절차", "업무방법", "업무지침", "업무안내",
            "업무담당자", "업무진행", "업무완료", "업무확인", "업무요청", "업무지연",
            "업무오류", "업무실수", "업무문의", "업무협조", "업무제한", "업무시스템"
        ));

        put("확인", Arrays.asList(
            "확인", "검증", "인증", "점검", "체크", "검사", "승인", "확정", "인가", "증명",
            "실명확인", "본인확인", "진위확인", "사실확인", "상태확인", "결과확인", "처리확인",
            "접수확인", "신청확인", "완료확인", "오류확인", "정보확인", "내역확인", "잔액확인",
            "한도확인", "승인확인", "거래확인", "입금확인", "출금확인", "예약확인"
        ));

        put("인증서", Arrays.asList(
            "인증서", "공동인증서", "금융인증서", "전자인증서", "공인인증서", "간편인증서",
            "인증서발급", "인증서갱신", "인증서등록", "인증서폐기", "인증서만료", "인증서복사",
            "인증서백업", "인증서이동", "인증서비밀번호", "인증서관리", "인증서재발급",
            "인증서유효기간", "인증서암호", "인증서저장", "인증서검증", "인증서오류",
            "인증서해지", "인증서신청", "인증서등록", "인증서발급", "인증서갱신"
        ));

        put("통장", Arrays.asList(
            "통장", "계좌", "거래내역", "잔액", "입출금", "통장정리", "통장발급", "통장재발급",
            "통장분실", "통장정지", "통장해지", "통장개설", "통장사본", "통장내역", "통장기장",
            "통장이체", "통장잔고", "통장번호", "통장비밀번호", "통장관리", "통장전환",
            "통장종류", "통장신청", "통장등록", "통장조회", "통장정보", "통장사용", "거래통장"
        ));

        put("한도", Arrays.asList(
            "한도", "한도금액", "한도조정", "한도증액", "한도감액", "이체한도", "출금한도",
            "대출한도", "신용한도", "카드한도", "거래한도", "한도초과", "한도설정", "한도변경",
            "한도조회", "한도상향", "한도하향", "한도신청", "한도승인", "일일한도", "월한도",
            "최대한도", "기본한도", "잔여한도", "한도관리", "한도제한", "한도해제", "한도정책"
        ));

        put("등록", Arrays.asList(
            "등록", "신규등록", "정보등록", "계좌등록", "카드등록", "인증서등록", "지문등록",
            "생체등록", "자동이체등록", "서비스등록", "앱등록", "기기등록", "등록신청",
            "등록확인", "등록완료", "등록취소", "등록정보", "등록방법", "등록절차", "등록현황",
            "등록내역", "등록상태", "등록일자", "등록번호", "등록증", "등록갱신", "등록해지"
        ));

        put("결과", Arrays.asList(
            "결과", "처리결과", "신청결과", "조회결과", "승인결과", "심사결과", "검토결과",
            "확인결과", "이체결과", "거래결과", "결과확인", "결과통지", "결과안내", "결과조회",
            "결과내역", "결과통보", "결과회신", "결과보고", "결과분석", "최종결과", "중간결과",
            "처리완료", "진행상태", "완료여부", "성공", "실패", "보류", "거절"
        ));

        put("적금", Arrays.asList(
            "적금", "정기적금", "자유적금", "청년적금", "주택청약적금", "급여적금", "스마트적금",
            "목돈마련", "저축상품", "적금이율", "적금이자", "적금만기", "적금해지", "적금가입",
            "적금계좌", "적금상품", "적금기간", "적금납입", "적금금리", "적금종류", "적금혜택",
            "적금추천", "적금비교", "적금신규", "적금연장", "적금해약", "적금인출", "월납입금"
        ));

        put("개인", Arrays.asList(
            "개인", "개인고객", "개인사업자", "개인정보", "신분증", "실명", "본인", "주민번호",
            "개인인증", "개인신용", "개인대출", "개인뱅킹", "개인자산", "개인계좌", "개인카드",
            "개인회원", "개인식별", "개인인증서", "개인한도", "개인등급", "개인맞춤", "개인상담",
            "개인정보수정", "개인정보변경", "개인정보보호", "개인정보동의", "개인정보처리"
        ));

        put("회원", Arrays.asList(
            "회원", "회원가입", "회원정보", "회원등록", "회원탈퇴", "회원��격", "회원서비스",
            "회원혜택", "회원등급", "회원카드", "회원인증", "회원확인", "회원조회", "회원변경",
            "회원상태", "회원약관", "회원가입신청", "회원정보수정", "회원정보변경", "회원자격상실",
            "회원특전", "회원우대", "회원관리", "회원식별", "신규회원", "기존회원", "휴면회원"
        ));

        put("비밀번호", Arrays.asList(
            "비밀번호", "패스워드", "PIN", "암호", "보안번호", "인증번호", "비밀번호변경",
            "비밀번호재설정", "비밀번호찾기", "비밀번호초기화", "비밀번호등록", "비밀번호설정",
            "비밀번호확인", "비밀번호오류", "비밀번호잠금", "비밀번호해제", "임시비밀번호",
            "비밀번호규칙", "비밀번호만료", "비밀번호갱신", "보안비밀번호", "계좌비밀번호",
            "카드비밀번호", "로그인비밀번호", "거래비밀번호", "인증비밀번호"
        ));

        put("소득", Arrays.asList(
            "소득", "수입", "급여", "연봉", "소득금액", "소득증빙", "소득공제", "소득신고",
            "소득확인", "소득증명", "소득수준", "소득분위", "소득기준", "소득인정", "근로소득",
            "사업소득", "금융소득", "임대소득", "연간소득", "월평균소득", "가계소득", "실질소득",
            "소득조회", "소득자료", "소득분석", "소득평가", "소득심사", "소득요건"
        ));

        put("증명서", Arrays.asList(
            "증명서", "확인서", "인증서", "증빙서류", "발급", "재발급", "증명서발급", "증명서신청",
            "증명서조회", "증명서출력", "증명서제출", "증명서확인", "증명서진위", "증명서원본",
            "증명서사본", "증명서번호", "증명서종류", "증명서양식", "증명서발행", "증명서유효기간",
            "증명서위조", "증명서진위확인", "전자증명서", "온라인증명서", "모바일증명서"
        ));

        put("증빙", Arrays.asList(
            "증빙", "증빙서류", "증빙자료", "증빙확인", "증빙제출", "증빙요청", "증빙검토",
            "증빙심사", "증빙완료", "증빙불가", "증빙누락", "증빙보완", "증빙반려", "증빙승인",
            "증빙확인서", "증빙사진", "증빙스캔", "증빙부분", "증빙등록", "증빙조회", "증빙관리",
            "증빙보관", "증빙기간", "증빙방법", "증빙절차", "증빙요건", "증빙양식"
        ));

        put("자료", Arrays.asList(
            "자료", "데이터", "정보", "문서", "서류", "파일", "자료제출", "자료요청", "자료확인",
            "자료검토", "자료등록", "자료조회", "자료수정", "자료삭제", "자료관리", "자료보관",
            "자료열람", "자료공유", "자료전송", "자료첨부", "자료다운로드", "자료업로드",
            "자료백업", "자료복구", "자료분석", "자료정리", "자료보안", "자료보호"
        ));

        put("입금", Arrays.asList(
            "입금", "송금", "이체", "납부", "충전", "입금계좌", "입금내역", "입금확인", "입금처리",
            "입금완료", "입금오류", "입금지연", "입금한도", "입금통장", "입금증", "입금자",
            "입금시간", "입금알림", "입금예정", "입금취소", "자동입금", "급여입금", "대량입금",
            "현금입금", "계좌입금", "무통장입금", "입금수수료", "입금제한"
        ));

        put("금리", Arrays.asList(
            "금리", "이자율", "이자", "금리우대", "금리인하", "금리조정", "금리적용", "금리계산",
            "금리비교", "금리혜택", "금리정보", "금리조회", "금리종류", "금리인상", "금리변동",
            "금리고정", "금리타입", "금리표", "우대금리", "기본금리", "약정금리", "대출금리",
            "예금금리", "적금금리", "변동금리", "고정금리", "특별금리", "금리정책"
        ));

        put("계약", Arrays.asList(
            "계약", "약정", "계약서", "계약조건", "계약기간", "계약해지", "계약변경", "계약갱신",
            "계약만료", "계약체결", "계약연장", "계약종료", "계약내용", "계약사항", "계약위반",
            "계약해제", "계약취소", "계약이행", "계약조항", "계약당사자", "계약번호", "계약일자",
            "계약상태", "계약관리", "재계약", "특약", "약관", "약정서"
        ));

        put("문의", Arrays.asList(
            "문의", "질문", "상담", "요청", "답변", "안내", "문의사항", "문의내용", "문의접수",
            "문의방법", "문의결과", "문의확인", "문의처리", "��의응대", "문의전화", "문의게시판",
            "문의등록", "문의조회", "문의답변", "문의완료", "문의취소", "문의분류", "문의유형",
            "문의상태", "1:1문의", "고객문의", "일반문의", "긴급문의"
        ));

        put("포인트", Arrays.asList(
            "포인트", "마일리지", "리워드", "적립", "사용", "포인트적립", "포인트사용", "포인트조회",
            "포인트전환", "포인트소멸", "포인트이체", "포인트충전", "포인트환급", "포인트혜택",
            "포인트정책", "포인트제도", "포인트카드", "포인트몰", "포인트결제", "포인트선물",
            "포인트양도", "포인트합산", "포인트할인", "포인트상품", "잔여포인트", "가용포인트"
        ));

        put("전화", Arrays.asList(
            "전화", "통화", "콜센터", "상담전화", "고객센터", "ARS", "전화상담", "전화문의",
            "전화연결", "전화번호", "전화접수", "전화응대", "전화예약", "전화확인", "전화대기",
            "전화통화", "전화안내", "전화주문", "전화상담사", "전화대응", "수신전화", "발신전화",
            "전화연락", "전화통보", "전화회신", "전화메모", "전화응답", "전화약속"
        ));

        put("모바일", Arrays.asList(
            "모바일", "스마트폰", "앱", "어플", "모바일뱅킹", "모바일앱", "모바일서비스",
            "모바일인증", "모바일결제", "모바일카드", "모바일조회", "모바일이체", "모바일신청",
            "모바일등록", "모바일로그인", "모바일버전", "모바일전용", "모바일기기", "모바일환경",
            "모바일보안", "모바일알림", "모바일접속", "모바일화면", "모바일계좌", "모바일지갑"
        ));

        put("기간", Arrays.asList(
            "기간", "기한", "날짜", "일자", "만기", "계약기간", "유효기간", "처리기간", "신청기간",
            "조회기간", "등록기간", "이용기간", "약정기간", "기간설정", "기간연장", "기간만료",
            "기간종료", "기간초과", "기간제한", "기간확인", "기간조정", "기간선택", "기간검색",
            "기간지정", "시작일", "종료일", "경과기간", "잔여기간"
        ));

        put("조건", Arrays.asList(
            "조건", "요건", "기준", "자격", "제한", "조건부", "조건변경", "조건확인", "조건검토",
            "조건충족", "조건미달", "조건설정", "조건적용", "조건수정", "조건추가", "조건삭제",
            "조건조회", "조건비교", "조건선택", "필수조건", "선택조건", "우대조건", "제약조건",
            "특별조건", "기본조건", "자격조건", "승인조건", "이용조건"
        ));

        put("조치", Arrays.asList(
            "조치", "처리", "해결", "대응", "처방", "조치사항", "조치내용", "조치결과", "조치방법",
            "조치완료", "조치확인", "조치요청", "조치계획", "조치절차", "조치단계", "조치시간",
            "조치담당", "조치보고", "조치현황", "긴급조치", "임시조치", "예방조치", "시정조치",
            "후속조치", "조치이행", "조치미흡", "조치지연", "조치불가"
        ));

        put("제출", Arrays.asList(
            "제출", "접수", "신청", "등록", "송부", "제출서류", "제출방법", "제출기한", "제출처",
            "제출완료", "제출확인", "제출요청", "제출상태", "제출자료", "제출증빙", "서류제출",
            "자료제출", "증빙제출", "제출기간", "제출양식", "제출절차", "제출누락", "제출보완",
            "제출반려", "제출취소", "제출접수", "제출검토", "제출승인", "온라인제출", "방문제출"
        ));

        put("화면", Arrays.asList(
            "화면", "페이지", "메뉴", "창", "디스플레이", "화면구성", "화면설정", "화면이동",
            "화면전환", "화면조회", "화면오류", "화면로딩", "화면갱신", "화면크기", "화면배치",
            "화면디자인", "화면구현", "화면표시", "화면확인", "메인화면", "초기화면", "상세화면",
            "팝업화면", "오류화면", "로그인화면", "조회화면", "입력화면", "결과화면"
        ));

        put("입력", Arrays.asList(
            "입력", "기입", "작성", "등록", "타이핑", "입력사항", "입력내용", "입력방법", "입력양식",
            "입력오류", "입력확인", "입력완료", "입력취소", "입력수정", "입력값", "입력필드",
            "입력창", "입력화면", "필수입력", "선택입력", "정보입력", "데이터입력", "코드입력",
            "번호입력", "금액입력", "날짜입력", "시간입력", "문자입력", "재입력", "직접입력"
        ));

        put("상태", Arrays.asList(
            "상태", "현황", "진행상태", "처리상태", "승인상태", "신청상태", "접수상태", "등록상태",
            "조회상태", "계좌상태", "거래상태", "카드상태", "상품상태", "서비스상태", "회원상태",
            "계약상태", "대출상태", "이체상태", "보안상태", "시스템상태", "운영상태", "정지상태",
            "해지상태", "만기상태", "연체상태", "사용상태", "유효상태", "잠금상태", "상태변경",
            "상태확인"
        ));
    }};

    public static List<String> recommendTagsForQuery(String query) {
        if (query == null || query.trim().isEmpty()) {
            return new ArrayList<>();
        }

        // 질문 토큰화
        List<String> questionTokens = FAQTokenizer.tokenizeNewQuestion(query);

        // 각 태그별 점수 계산
        Map<String, Double> tagScores = calculateTagScores(questionTokens);

        // 상위 3개 태그 선택
        return tagScores.entrySet().stream()
                .sorted((e1, e2) -> Double.compare(e2.getValue(), e1.getValue()))
                .limit(3)
                .map(Map.Entry::getKey)
                .collect(Collectors.toList());
    }

    private static Map<String, Double> calculateTagScores(List<String> tokens) {
        Map<String, Double> scores = new HashMap<>();

        // 각 태그에 대한 점수 계산
        for (String tag : PREDEFINED_TAGS) {
            double score = calculateTagScore(tokens, tag);
            scores.put(tag, score);
        }

        return scores;
    }

    private static double calculateTagScore(List<String> tokens, String tag) {
        // 기본 점수 계산 (직접 일치)
        double directMatchScore = tokens.stream()
                .filter(token -> token.equals(tag))
                .count() * 2.0;  // 직접 일치는 가중치 2배

        // 관련 키워드 매칭 점수
        double keywordMatchScore = 0.0;
        List<String> relatedKeywords = TAG_KEYWORDS.getOrDefault(tag, Collections.emptyList());

        for (String token : tokens) {
            if (relatedKeywords.contains(token)) {
                keywordMatchScore += 1.0;
            }
        }

        return directMatchScore + keywordMatchScore;
    }
}